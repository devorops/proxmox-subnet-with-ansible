- name: include variables
  include_vars: '{{ inventory_dir }}/enforce_value_vars.yml'
  no_log: true
- name: include vault variables(proxmox cluster password)
  include_vars: vars/vault.yml
  no_log: true
- block:
    - name: Cloning a VM with Vm-id "{{ vmid }}" from a Proxmox VM template with VM-id "{{ template_vmid }}" on "{{ storage }}" storage..
      proxmox_kvm:
        api_user    : root@pam
        api_password: "{{ proxmox_password }}"
        api_host    : "{{ api_host }}"
        clone       : "ANY_VALUE"
        newid       : "{{ vmid }}"
        vmid        : "{{ template_vmid }}"
        name        : "{{ new_machine_name }}"
        node        : "{{ proxmox_node_name }}" 
        full        : "{{ full_clone }}"
        storage     : "{{ storage }}"
    - name: Waiting a bit for the Hypervisor to catch up..
      pause:
        seconds: 20
  when: ( force_variable_check == false or ( vmid | int <= toVmid | int and fromVmid | int <= vmid | int ))
